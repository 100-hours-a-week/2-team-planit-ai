services:
  planit:
    container_name: planit
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "${PORT:-8000}:${PORT:-8000}"
    env_file:
      - path: .env
        required: false
    environment:
      HOST: "${HOST:-0.0.0.0}"
      PORT: "${PORT:-8000}"
      LLM_CLIENT_TIMEOUT: "${LLM_CLIENT_TIMEOUT:-30}"
      LLM_CLIENT_MAX_RETRIES: "${LLM_CLIENT_MAX_RETRIES:-3}"
      VLLM_CLIENT_MAX_TOKENS: "${VLLM_CLIENT_MAX_TOKENS:-2048}"
      LLM_CLIENT_TEMPERATURE: "${LLM_CLIENT_TEMPERATURE:-0.7}"
      LLM_CLIENT_TOP_P: "${LLM_CLIENT_TOP_P:-0.9}"
      OPENAI_API_KEY: "${OPENAI_API_KEY:-}"
      OPENAI_BASE_URL: "${OPENAI_BASE_URL:-https://api.openai.com/v1}"
      OPENAI_MODEL: "${OPENAI_MODEL:-}"
      VLLM_BASE_URL: "${VLLM_BASE_URL:-}"
      VLLM_MODEL: "${VLLM_MODEL:-}"
      GOOGLE_MAPS_API_KEY: "${GOOGLE_MAPS_API_KEY:-}"
      TAVILY_API_KEY: "${TAVILY_API_KEY:?TAVILY_API_KEY is required}"
      LANGEXTRACT_API_KEY: "${LANGEXTRACT_API_KEY:?LANGEXTRACT_API_KEY is required}"
    volumes:
      - ./logs/ai:/var/log/planit/ai
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "10"
    restart: unless-stopped
